# YouTube Sync Service

Автоматический сервис для синхронизации видео с YouTube каналов и плейлистов.

## Возможности

- ✅ Автоматическая загрузка видео с YouTube каналов и плейлистов
- ✅ Конфигурация через YAML файл
- ✅ Именование файлов в формате "Название-ГГГГ-ММ-ДД.расширение"
- ✅ Загрузка в наилучшем качестве
- ✅ Индивидуальная настройка периода для каждой ссылки
- ✅ Использование встроенных фильтров yt-dlp для эффективности
- ✅ Совместимость с Plex Media Server
- ✅ Docker контейнеризация
- ✅ Планировщик для автоматической синхронизации
- ✅ Логирование всех операций

## Быстрый старт

### 1. Настройка конфигурации

Отредактируйте файл `config.yaml`:

```yaml
youtube:
  channels:
    - url: "https://www.youtube.com/@вашканал1"
      period_days: 30  # Загружать за последние 30 дней
    - url: "https://www.youtube.com/@вашканал2"
      period_days: 14  # Загружать за последние 2 недели
    - url: "https://www.youtube.com/@вашканал3"
      # Если period_days не указан, используется default_period_days
  
  playlists:
    - url: "https://www.youtube.com/playlist?list=PLваш_плейлист"
      period_days: 60  # Загружать за последние 2 месяца

download:
  output_dir: "/app/downloads"
  quality: "best[ext=mp4]/best"
  default_period_days: 30  # Период по умолчанию, если не указан для ссылки

scheduler:
  sync_interval_hours: 6
  first_run_time: "08:00"
```

### 2. Запуск с Docker Compose

```bash
# Сборка и запуск
docker-compose up -d

# Просмотр логов
docker-compose logs -f ytsync

# Остановка
docker-compose down
```

### 3. Запуск без Docker

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск сервиса
python main.py
```

## Формат конфигурации

### Новый формат (с индивидуальными настройками):
```yaml
youtube:
  channels:
    - url: "https://www.youtube.com/@канал"
      period_days: 30
  playlists:
    - url: "https://www.youtube.com/playlist?list=список"
      period_days: 60
```

### Совместимость со старым форматом:
```yaml
youtube:
  channels:
    - "https://www.youtube.com/@канал"  # Будет использован default_period_days
  playlists:
    - "https://www.youtube.com/playlist?list=список"
```

## Структура проекта

```
ytsync/
├── main.py              # Основной код сервиса
├── config.yaml          # Конфигурация
├── requirements.txt     # Python зависимости
├── Dockerfile          # Образ Docker
├── docker-compose.yml  # Конфигурация Docker Compose
├── downloads/          # Папка для загруженных видео
└── logs/              # Папка для логов
```

## Настройки конфигурации

### YouTube источники
- `channels` - список каналов для синхронизации
  - `url` - URL канала
  - `period_days` - период загрузки для этого канала (опционально)
- `playlists` - список плейлистов для синхронизации
  - `url` - URL плейлиста
  - `period_days` - период загрузки для этого плейлиста (опционально)

### Настройки загрузки
- `output_dir` - папка для сохранения видео
- `quality` - качество загрузки (`best`, `worst`, `best[height<=720]` и т.д.)
- `max_file_size` - максимальный размер файла в МБ (0 = без ограничений)
- `max_duration` - максимальная длительность в секундах (0 = без ограничений)
- `default_period_days` - период загрузки по умолчанию, если не указан для конкретной ссылки (30 дней)

### Планировщик
- `sync_interval_hours` - интервал между синхронизациями в часах
- `first_run_time` - время первого запуска в формате "ЧЧ:ММ"

## Именование файлов

Файлы сохраняются в формате: `Название видео-ГГГГ-ММ-ДД.расширение`

Примеры:
- `Обзор нового телефона-2024-06-22.mp4`
- `Урок программирования-2024-06-21.mp4`

## Мониторинг

Сервис создает подробные логи в файле `ytsync.log` и выводит информацию в консоль.

Уровни логирования:
- `INFO` - общая информация о работе
- `ERROR` - ошибки загрузки
- `DEBUG` - детальная отладочная информация

## Совместимость с Plex

Сервис настроен для максимальной совместимости с Plex Media Server:
- Приоритет формата MP4
- Использование FFmpeg для конвертации
- Совместимые видео/аудио кодеки
- Эффективная фильтрация через встроенные параметры yt-dlp

## Требования

- Python 3.11+
- FFmpeg (устанавливается автоматически в Docker)
- Интернет соединение
- ~1GB свободного места на диске для временных файлов

## Безопасность

- Сервис работает от непривилегированного пользователя
- Ограничения по ресурсам в Docker
- Безопасная обработка имен файлов